# ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ SEHException –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞ Revit

## üö® –ü—Ä–æ–±–ª–µ–º–∞
–ü—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —ç–∫—Å–ø–æ—Ä—Ç–∞ –≤–æ–∑–Ω–∏–∫–∞–ª–∞ –æ—à–∏–±–∫–∞:
```
‚ö†Ô∏è SEHException –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞: –í–Ω–µ—à–Ω–∏–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Å–æ–∑–¥–∞–ª –∏—Å–∫–ª—é—á–µ–Ω–∏–µ.
```

**–ü—Ä–∏—á–∏–Ω–∞**: `SEHException` (Structured Exception Handling) –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å COM-–æ–±—ä–µ–∫—Ç–∞–º–∏ Revit API, –æ—Å–æ–±–µ–Ω–Ω–æ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤.

## üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –£–ª—É—á—à–µ–Ω –º–µ—Ç–æ–¥ `SafeCloseDocument`

**–§–∞–π–ª**: `RevitExporterAddin/Views/MainWindow.xaml.cs`  
**–°—Ç—Ä–æ–∫–∏ 4937-4979**

**–î–æ–±–∞–≤–ª–µ–Ω–æ:**
- ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞** –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º
- ‚úÖ **–£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ SEHException** —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏
- ‚úÖ **–û–±—Ä–∞–±–æ—Ç–∫–∞ COMException** –¥–ª—è COM-–æ–±—ä–µ–∫—Ç–æ–≤
- ‚úÖ **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –∏—Å–∫–ª—é—á–µ–Ω–∏–π** —Å –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π

**–ö–æ–¥:**
```csharp
private void SafeCloseDocument(Document document, string filePath)
{
    if (document == null)
        return;

    try
    {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –¥–æ–∫—É–º–µ–Ω—Ç –µ—â–µ –æ—Ç–∫—Ä—ã—Ç
        if (document.IsValidObject)
        {
            // –ü—ã—Ç–∞–µ–º—Å—è –∑–∞–∫—Ä—ã—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç
            document.Close(false);
            WriteDetailedLog("‚úÖ –î–æ–∫—É–º–µ–Ω—Ç —É—Å–ø–µ—à–Ω–æ –∑–∞–∫—Ä—ã—Ç");
        }
        else
        {
            WriteDetailedLog("‚ö†Ô∏è –î–æ–∫—É–º–µ–Ω—Ç —É–∂–µ –∑–∞–∫—Ä—ã—Ç –∏–ª–∏ –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω");
        }
    }
    catch (System.Runtime.InteropServices.SEHException sehEx)
    {
        // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º SEHException (–≤–Ω–µ—à–Ω–∏–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Å–æ–∑–¥–∞–ª –∏—Å–∫–ª—é—á–µ–Ω–∏–µ)
        WriteDetailedLog($"‚ö†Ô∏è SEHException –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞: {sehEx.Message}");
        WriteToLogFile($"‚ö†Ô∏è SEHException –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞ {Path.GetFileName(filePath)}: {sehEx.Message}");
        WriteToLogFile($"‚ö†Ô∏è –≠—Ç–æ —Å–∏—Å—Ç–µ–º–Ω–æ–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –º–æ–∂–µ—Ç –≤–æ–∑–Ω–∏–∫–∞—Ç—å –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å COM-–æ–±—ä–µ–∫—Ç–∞–º–∏ Revit");
        WriteToLogFile($"‚ö†Ô∏è –ò—Å–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–æ–∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–æ –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã");
    }
    catch (System.Runtime.InteropServices.COMException comEx)
    {
        // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º COMException
        WriteDetailedLog($"‚ö†Ô∏è COMException –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞: {comEx.Message}");
        WriteToLogFile($"‚ö†Ô∏è COMException –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞ {Path.GetFileName(filePath)}: {comEx.Message}");
        WriteToLogFile($"‚ö†Ô∏è –ò—Å–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–æ–∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–æ –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã");
    }
    catch (Exception ex)
    {
        // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è
        WriteDetailedLog($"‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞: {ex.Message}");
        WriteToLogFile($"‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞ {Path.GetFileName(filePath)}: {ex.Message}");
        WriteToLogFile($"‚ö†Ô∏è –¢–∏–ø –∏—Å–∫–ª—é—á–µ–Ω–∏—è: {ex.GetType().Name}");
        WriteToLogFile($"‚ö†Ô∏è –ò—Å–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–æ–∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–æ –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã");
    }
}
```

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç

### –¢–µ–ø–µ—Ä—å –ø—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ SEHException:
1. **–û—à–∏–±–∫–∞ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è** —Å –ø–æ–¥—Ä–æ–±–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
2. **–ü—Ä–æ–≥—Ä–∞–º–º–∞ –Ω–µ –ø–∞–¥–∞–µ—Ç** - –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è
3. **–≠–∫—Å–ø–æ—Ä—Ç –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è** —Å –¥—Ä—É–≥–∏–º–∏ —Ñ–∞–π–ª–∞–º–∏
4. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç** –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:
```
‚ö†Ô∏è SEHException –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞: –í–Ω–µ—à–Ω–∏–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Å–æ–∑–¥–∞–ª –∏—Å–∫–ª—é—á–µ–Ω–∏–µ.
‚ö†Ô∏è –≠—Ç–æ —Å–∏—Å—Ç–µ–º–Ω–æ–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –º–æ–∂–µ—Ç –≤–æ–∑–Ω–∏–∫–∞—Ç—å –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å COM-–æ–±—ä–µ–∫—Ç–∞–º–∏ Revit
‚ö†Ô∏è –ò—Å–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–æ–∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–æ –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã
```

## üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å**
- ‚úÖ –ü—Ä–æ–≥—Ä–∞–º–º–∞ –Ω–µ –ø–∞–¥–∞–µ—Ç –ø—Ä–∏ SEHException
- ‚úÖ –≠–∫—Å–ø–æ—Ä—Ç –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è —Å –¥—Ä—É–≥–∏–º–∏ —Ñ–∞–π–ª–∞–º–∏
- ‚úÖ Graceful degradation

### 2. **–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω–æ—Å—Ç—å**
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ—à–∏–±–æ–∫
- ‚úÖ –ü–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

### 3. **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å**
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –∏—Å–∫–ª—é—á–µ–Ω–∏–π
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π

## üîç –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

### SEHException –≤ Revit API:
- **–ü—Ä–∏—á–∏–Ω–∞**: COM-–æ–±—ä–µ–∫—Ç—ã Revit –º–æ–≥—É—Ç –≤—ã–∑—ã–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è
- **–†–µ—à–µ–Ω–∏–µ**: –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏—è –±–µ–∑ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è —Ä–∞–±–æ—Ç—ã
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –°—Ç–∞–±–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

### –ü—Ä–æ–≤–µ—Ä–∫–∞ `document.IsValidObject`:
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –¥–æ–∫—É–º–µ–Ω—Ç –µ—â–µ –æ—Ç–∫—Ä—ã—Ç
- **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ**: –ò–∑–±–µ–∂–∞—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∑–∞–∫—Ä—ã—Ç–∏—è
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –æ—à–∏–±–æ–∫

## üéØ –°—Ç–∞—Ç—É—Å
**‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û** - SEHException –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ, –ø—Ä–æ–≥—Ä–∞–º–º–∞ –Ω–µ –ø–∞–¥–∞–µ—Ç

---
**–î–∞—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:** 25.10.2025  
**–í–µ—Ä—Å–∏—è:** Debug  
**–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞:** x64
